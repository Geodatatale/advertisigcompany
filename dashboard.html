<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="author" content="Geoffrey Asira">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>zoomadvertising</title>
        <link rel="stylesheet" href="src/leaflet.css">
        <link rel="stylesheet" href="src/css/bootstrap.css">
        <link rel="stylesheet" href="src/plugins/L.Control.MousePosition.css">
        <link rel="stylesheet" href="src/plugins/L.Control.Sidebar.css">
        <link rel="stylesheet" href="src/plugins/easy-button.css">
        <link rel="stylesheet" href="src/css/popupstyle.css">
        <link rel="stylesheet" href="src/plugins/leaflet-styleeditor/css/Leaflet.StyleEditor.css">
        <link rel="stylesheet" href="src/css/font-awesome.min.css">
        <link rel="stylesheet" href="src/plugins/leaflet.awesome-markers.css">
        <link rel="stylesheet" href="src/plugins/leaflet-mapkey/MapkeyIcons.css">
        <link rel="stylesheet" href="src/plugins/leaflet-mapkey/L.Icon.Mapkey.css">
        <link rel="stylesheet" href="src/plugins/MarkerCluster.css">
        <link rel="stylesheet" href="src/plugins/MarkerCluster.Default.css">
        <link rel="stylesheet" href="src/plugins/leaflet-legend.css">
        <link rel="stylesheet" href="src/jquery-ui.min.css">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"/>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"/>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
        <link rel="stylesheet" href="src/css/head.css">
        <link rel="stylesheet" href="src/Leaflet.BigImage.min.css">
        <link rel="stylesheet" href="src/plugins/leaflet.groupedlayercontrol.min.css">
        <link rel="stylesheet" href="src/css/dashstyle.css">
        <link rel="stylesheet" href="src/css/styles.css">
        <script src="src/leaflet-src.js"></script>
        <script src="src/jquery-3.2.0.min.js"></script>
        <script src="src/plugins/L.Control.MousePosition.js"></script>
        <script src="src/plugins/L.Control.Sidebar.js"></script>
        <script src="src/plugins/Leaflet.PolylineMeasure.js"></script>
        <script src="src/plugins/easy-button.js"></script>
        <script src="src/plugins/leaflet-providers.js"></script>
        <script src="src/plugins/leaflet-styleeditor/javascript/Leaflet.StyleEditor.js"></script>
        <script src="src/plugins/leaflet-styleeditor/javascript/Leaflet.StyleForms.js"></script>
        <script src="src/plugins/leaflet.ajax.min.js"></script>
        <script src="src/plugins/leaflet.sprite.js"></script>
        <script src="src/plugins/leaflet.awesome-markers.min.js"></script>
        <script src="src/plugins/leaflet-mapkey/L.Icon.Mapkey.js"></script>
        <script src="src/plugins/leaflet.markercluster.js"></script>
        <script src="src/plugins/leaflet.geometryutil.js"></script>
        <script src="src/plugins/leaflet-legend.js"></script>
        <script src="src/jquery-ui.min.js"></script>
        <script src="src/turf.min.js"></script>
        <script src="src/Leaflet.BigImage.min.js"></script>
        <script src="src/plugins/leaflet.groupedlayercontrol.min.js"></script>
        <link rel="shortcut icon" href="img/logo/circle logo.png">

	<link href="assets/bootstrap-4.5.0-dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="assets/bootstrap-4.5.0-dist/css/bootstrap.css" rel="stylesheet">
	<link href="css/custom.css" rel="stylesheet" media="screen">
	<link href="assets/font awesome/css/fontawesome.css" rel="stylesheet" media="screen">
        
        
<!--    ***************  Begin Leaflet.Draw-->
    
        <script src="src/plugins/leaflet-search.js"></script>
         
        
<!--    **************  End of Lealet Draw-->

    </head>
    <body>
        <nav class="navbar fixed-top navbar-expand-md" id="navheader" >
  <div class="container-fluid">
    <a class="navbar-brand" href="index.html"><img class="logo" src="img/logo/bilboard.png" width="auto" height="60" alt=""></a>

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"><span><i class="fa fa-bars"></i></span></button>

    <div class="collapse navbar-collapse justify-content-md-end" id="navbarNav">

      <ul class="navbar-nav">
        <li><a href="index.html" >Home</a></li>
        <li><a href="about.html">About Us</a></li>
        <li><a href="services.html">Services</a></li>
        <li><a href="dashboard.html" class="active">Locations</a></li>
        <li><a href="contact.html">Contact Us</a></li>
      </ul>

      <span class="navbar-text"><a href="https://twitter.com/Zoom" class="nav-icon"><span class="fa fa-twitter"></span></a></span>
      <span class="navbar-text"><a href="https://Zoom.com" class="nav-icon"><span class="fa fa-google-plus"></span></a></span>
      <span class="navbar-text"><a href="https://www.facebook.com/Zoomadvertsing" class="nav-icon"><span class="fa fa-facebook"></span></a></span><br>

      <div class="copy-right">
        <div class="col-md-12">
          <strong><span>Copyright &copy; 2022 Zoom Advertising.</span></strong> All Rights Reserved | Designed by: <a href="www.datatale.com"> <strong>Zoom Advertising</strong></a>
        </div>
      </div>
                
    </div>
  </div>
</nav>
       <section id="me">
        <div id="side-bar" class="col-md-11">
           <div><div class="topheader">
            <button id='btnLocate' class='btn btn-primary btn-block'>Locate</button>
  
            <div id="divBilboard" class="col-xs-12 topheader" >
                <div id="divBilboardLabel" class="text-center col-xs-12">
                    <h4 id="lblBilboard"><b>Side View Outdoor billboards</b></h4>
                </div>
                <div id="divBilboardError" class="errorMsg col-xs-12"></div>
                
                <div id="divFilterBilboard" class="col-xs-12">
                    <div class="col-xs-4">
                        <input type='radio' name='fltBilboard' value='ALL' checked>All
                    </div>
                    <div class="col-xs-4">
                        <input type='radio' name='fltBilboard' value='Available'>Available
                    </div>
                    <div class="col-xs-4">
                        <input type='radio' name='fltBilboard' value='Not Available'>Not Available
                    </div>
                    <div class="col-xs-4">
                        <input type='radio' name='fltBilboard' value='Reserved'>Reserved
                    </div>
                    <div class="col-xs-4">
                        <input type='radio' name='fltBilboard' value='Under Construction'>Under Construction
                    </div>
                </div>
                <div class="" id="divBilboardData"></div>
            </div>
             </div>
              <div class="sidebar">
     
    </div>
        </div>
        </div>
        <div id="mapdiv" class="col-md-12"></div>
        <script>
            var mymap;
            var lyrOSM;
            var lyrWatercolor;
            var lyrTopo;
            var lyrImagery;
            var lyrOutdoors;
            var lyrSearch;
            var lyrMarkerCluster;
            var mrkCurrentLocation;
            var fgpDrawnItems;
            var ctlAttribute;
            var ctlScale;
            var ctlMouseposition;
            var ctlEasybutton;
            var ctlSidebar;
            var ctlLayers;
            var ctlStyle;
            var ctlLegend;
            var ctlGroupLayer;
            var objBasemaps;
            var objOverlays;
            var arProjectIDs = [];
            var arBillboardIDs = [];
            var myIcon;
            var billboardiconunder;
            var bilboardicon;
            var lyrbilboards;
            var bilboardiconva;
            var layergroup;
            
            $(document).ready(function(){
                
                //  ********* Map Initialization ****************
                
                mymap = L.map('mapdiv', {center:[-1.30996,36.82401], zoom:16.2, attributionControl:false});
                
                ctlSidebar = L.control.sidebar('side-bar').addTo(mymap);
                
                ctlEasybutton = L.easyButton('glyphicon-transfer', function(){
                   ctlSidebar.toggle(); 
                }).addTo(mymap);
                
                ctlAttribute = L.control.attribution().addTo(mymap);
                ctlAttribute.addAttribution('OSM');
                ctlAttribute.addAttribution('&copy; <a href="http://datatale.com">Geoffrey asira LLC</a>');
                
                ctlScale = L.control.scale({position:'bottomleft', metric:false, maxWidth:200}).addTo(mymap);
                
              
                ctlMouseposition = L.control.mousePosition().addTo(mymap);
                //   *********** Layer Initialization **********
                var Jawg_Dark = L.tileLayer('https://{s}.tile.jawg.io/jawg-dark/{z}/{x}/{y}{r}.png?access-token={accessToken}', {
	attribution: '<a href="http://jawg.io" title="Tiles Courtesy of Jawg Maps" target="_blank">&copy;  contributors',
	minZoom: 0,
	maxZoom: 22,
	subdomains: 'abcd',
	accessToken: ' 0s5dBwPnRsDDF47Yw5nmW6OD5dsdOfn3t7Z9jKUaGqafPXPcvoAqTOuORA14yVWa'
});
                var Jawg_Matrix = L.tileLayer('https://{s}.tile.jawg.io/jawg-matrix/{z}/{x}/{y}{r}.png?access-token={accessToken}', {
	attribution: '<a href="http://jawg.io" title="Tiles Courtesy of Jawg Maps" target="_blank">&copy; <b>Jawg</b>Maps</a> &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
	minZoom: 0,
	maxZoom: 22,
	subdomains: 'abcd',
	accessToken: ' 0s5dBwPnRsDDF47Yw5nmW6OD5dsdOfn3t7Z9jKUaGqafPXPcvoAqTOuORA14yVWa '
});
                var basemapCartoNoLabels = L.tileLayer('http://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png', {
        attribution: '&copy;OpenStreetMap, &copy;CartoDB'
    });
                var Stadia_AlidadeSmoothDark = L.tileLayer('https://tiles.stadiamaps.com/tiles/alidade_smooth_dark/{z}/{x}/{y}{r}.png'
                 );
            
                lyrOSM = L.tileLayer.provider('OpenStreetMap.Mapnik');
                lyrTopo = L.tileLayer.provider('Thunderforest.Outdoors');
                lyrImagery = L.tileLayer.provider('Esri.WorldImagery');
        
                
                mymap.addLayer(Jawg_Dark);
               
                
                 bilboardicon = L.icon({
                iconUrl:'markers/available.png',
                iconSize: [25, 25],
                iconAnchor: [10, 12],
                popupAnchor: [0, -28]
                });
                bilboardiconva = L.icon({
                iconUrl:'markers/notavailable.png',
                iconSize: [25, 25],
                iconAnchor: [10, 12],
                popupAnchor: [0, -28]
                });
                myIcon = L.icon({
                iconUrl:'markers/reserved.png',
                iconSize: [25, 25],
                iconAnchor: [10, 12],
                popupAnchor: [0, -28]
                });
                billboardiconunder =  L.icon({
                iconUrl:'markers/Underconstruction.png',
                iconSize: [25, 25],
                iconAnchor: [10, 12],
                popupAnchor: [0, -28]
                });
                lyrbilboards = L.geoJSON.ajax('data/newbilboard.geojson',{pointToLayer:returnBilboardmarker,onEachFeature: onEachFeature,filter:filterBilboard,}).addTo(mymap).on('click', function () {
            ctlSidebar.show();
        });;
                function onEachFeature(feature, layer) {
                layer.on('click', function(e) {
                    $(".sidebar").html("--  --"+"<section class='sidebarsec'>"+"<p>"+"<b style='color: dodgerblue;'>"+"bilboard id #" +feature.properties.f_id+"</b>"+"<br>"+"<p>"+feature.properties.description +"</p>"+"<img src='img/" + feature.properties.image_url+"' id='board' >"+"<img src='markers/impression.png' style='background-color: white;'>"+"<strong>"+"Impression: "+"</strong>" +feature.properties.daily_impressions+"<br>"+"<br>"+"<img src='markers/illumination.png' style='background-color: white;'>"+"<strong>"+"Illumination: "+"</strong>" +feature.properties.illuminated+"<br>"+"<br>"+"<img src='markers/size.png' style='background-color: white;'>"+"<strong>"+"Size: "+"</strong>" +feature.properties.size+"<br>" );
                 });
                }
                lyrbilboards.on('data:loaded', function(){
                    arBillboardIDs.sort(function(a,b){return a-b});
                    $("#txtFindBilboard").autocomplete({
                        source:arBillboardIDs
                    });
                });

               
                // ********* Setup Layer Control  ***************
                
                objBasemaps = {
                    "Dark Base":Jawg_Dark,
                    "Open Street Maps": lyrOSM,
                    "Imagery":lyrImagery,
                   
                };
            
                var  groupedOverlays = {
                    "Sideview Media Nation":{
                    "Billboards":lyrbilboards,
                    },        
                };
                var options = {
                 // Make the "Landmarks" group exclusive (use radio inputs)
                exclusiveGroups: ["Real estate Properties"],
                 // Show a checkbox next to non-exclusive group labels for toggling all
                groupCheckboxes: false,
                collapsed: false,
                };
                ctlGroupLayer = L.control.groupedLayers(objBasemaps, groupedOverlays,options  );
                mymap.addControl(ctlGroupLayer);
                
                 //***** search control ***   
              mymap.addControl(L.control.search({position:'topleft'}));
                //** legend **
                
                let legend = L.control({position: "topright"});
                legend.onAdd = function() {
                let div = L.DomUtil.create("div", "legend");
                    div.innerHTML =
                '<b>Bilboard Status<br /></b><table><tr><td style="text-align: center;"><img src="legend/leg3.png" id="san" /> </td><td>&nbsp;&nbsp; Not Available</td></tr><tr><td style="text-align: center;"><img src="legend/available1.png" id="san" /> </td><td>&nbsp;&nbsp; Available</td></tr></tr><tr><td style="text-align: center;"><img src="legend/leg1.png" id="san"/> </td><td>&nbsp;&nbsp; Reserved</td></tr></tr><tr><td style="text-align: center;"><img src="legend/leg2.png" id="san" /> </td><td>&nbsp;&nbsp; Under Construction</td></tr></table>' ;
                return div;
                };
                legend.addTo(mymap);
               
                
                // ************ Location Events **************
                
                mymap.on('locationfound', function(e) {
                    console.log(e);
                    if (mrkCurrentLocation) {
                        mrkCurrentLocation.remove();
                    }
                    mrkCurrentLocation = L.circle(e.latlng, {radius:e.accuracy/2}).addTo(mymap);
                    mymap.setView(e.latlng, 14);
                });
                
                mymap.on('locationerror', function(e) {
                    console.log(e);
                    alert("Location was not found");
                })
                
            });
            
            // ********* billboard Functions *****************
            $("#btnBilboard").click(function(){
               $("#lgndBilboardDetail").toggle(); 
            });
             function returnBilboardmarker(json, latlng){
                 var att = json.properties;
                if (att.status=='Available') {
                    var clrNest = bilboardicon;
                } else if (att.status=='Reserved') {
                    var clrNest = myIcon;
                } else if (att.status=='Under Construction') {
                    var clrNest = billboardiconunder;
                }  else {
                    var clrNest = bilboardiconva;
                }
                return L.marker(latlng, { icon:clrNest}).bindPopup(" &nbsp; &nbsp;&nbsp;"+"<img src='img/" + att.image_url+"' id='popimg' >"+"<b>"+"BillboardID:#"+" &nbsp; &nbsp;&nbsp;"+att.f_id+"</b>"+ 
                '<table>\
                  \
                    <tr>\
                        <th scope="row">Status</th>\
                        <td>' + att.status + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Size</th>\
                        <td>' + att.size + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Direction</th>\
                        <td>' + att.physical_location + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Available date</th>\
                        <td>' + att.end_date + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">UTM_X</th>\
                        <td>' + att.x_coordinate + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">UTM_Y</th>\
                        <td>' + att.y_coordinate + '</td>\
                    </tr>\
                </table>'+"<br>"+"<div>"+"<div class='text-center'>"+"<a href='contact.html'>"+
               "<button class='btn btn-primary btn-block' onclick='openPopup()' id='btm'>"+"Booking"+"</button>"+"</a>"+
                "</div>"+
              "</div>"  ,{minWidth:300,minHeight:300} );
                
             }
           let popup = document.getElementById("popups");
            function openPopup() {
                popups.classList.add("open-popups");
            }
            function closePopup() {
                popups.classList.remove("open-popups");
            }
            function returnBilboardID(id){
                var arLayers = lyrbilboards.getLayers();
                for(i=0;i<arLayers.length-1;i++){
                    var bilboardID = arLayers[i].feature.properties.Property;
                    if(bilboardID== id){
                        return arLayers[i];
                    }
                }
                return false;
            }
            $("#btnFindBilboard").click(function(){
                var id = $("#txtFindBilboard").val();
                var lyr = returnBilboardID(id);
                if (lyr) {
                    if(lyrSearch) {
                        lyrSearch.remove();
                    }
                    lyrSearch = L.geoJSON(lyr.toGeoJson(),{style:{color:'red',weight:10,opacity:0.5}}).addTo(mymap);
                    mymap.fitBounds(lyr.getBounds().pad(1));
                }
            });
            
             function filterBilboard(json) {
                var att=json.properties;
                var optFilter = $("input[name=fltBilboard]:checked").val();
                if (optFilter=='ALL') {
                    return true;
                } else {
                    return (att.status==optFilter);
                }
            }
            
            $("#txtFindBilboard").on('keyup paste', function(){
                var val = $("#txtFindBilboard").val();
                testLayerAttribute(arBillboardIDs, val, "Bilboard ID", "#divFindBilboard", "#divBilboardError", "#btnFindBilboard");
            });
            
            $("#btnFindBilboard").click(function(){
                var val = $("#txtFindBilboard").val();
                var lyr = returnLayerByAttribute(lyrbilboards,'id',val);
                if (lyr) {
                    if (lyrSearch) {
                        lyrSearch.remove();
                    }
                    lyrSearch = L.circle(lyr.getLatLng(), {radius:30, color:'red', weight:10, opacity:0.5, fillOpacity:0}).addTo(mymap);
                    mymap.setView(lyr.getLatLng(), 14);
                    var att = lyr.feature.properties;
                    $("#divBilboardData").html(" &nbsp; &nbsp;&nbsp;"+"<img src='img/" + att.image_url+"' id='popimg' >"+"<b>"+"BillboardID:#"+" &nbsp; &nbsp;&nbsp;"+att.id+"</b>"+ 
                '<table>\
                  \
                    <tr>\
                        <th scope="row">Status</th>\
                        <td>' + att.status + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Size</th>\
                        <td>' + att.size + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Direction</th>\
                        <td>' + att.location + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Available date</th>\
                        <td>' + att.end_time + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">UTM_X</th>\
                        <td>' + att.x_coordinate + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">UTM_Y</th>\
                        <td>' + att.y_coordinate + '</td>\
                    </tr>\
                </table>');
                    $("#divBilboardError").html("");
                    
                 } else {
                    $("#divBilboardError").html("**** Bilboard ID not found ****");
                }
            });
            
            $("#lblBilboard").click(function(){
                $("#divBilboardData").toggle(); 
            });
            
            $("input[name=fltBilboard]").click(function(){
                arBillboardIDs=[];
                lyrbilboards.refresh();
            });
            

            //  *********  jQuery Event Handlers  ************
            
            $("#btnGBH").click(function(){
               $("#lgndGBHDetail").toggle(); 
            });
            
            $("#btnLocate").click(function(){
                mymap.locate();
            });
            
            $("#btnShowLegend").click(function(){
                $("#legend").toggle();
            });
            
            //  ***********  General Functions *********
            function LatLngToArrayString(ll) {
                return "["+ll.lat.toFixed(5)+", "+ll.lng.toFixed(5)+"]";
            }
            
            function returnLayerByAttribute(lyr,att,val) {
                var arLayers = lyr.getLayers();
                for (i=0;i<arLayers.length-1;i++) {
                    var ftrVal = arLayers[i].feature.properties[att];
                    if (ftrVal==val) {
                        return arLayers[i];
                    }
                }
                return false;
            }
            
            function testLayerAttribute(ar, val, att, fg, err, btn) {
                if (ar.indexOf(val)<0) {
                    $(fg).addClass("has-error");
                    $(err).html("**** "+att+" NOT FOUND ****");
                    $(btn).attr("disabled", true);
                } else {
                    $(fg).removeClass("has-error");
                    $(err).html("");
                    $(btn).attr("disabled", false);
                }
            }
          
        </script>
        </section>
    </body>
</html>